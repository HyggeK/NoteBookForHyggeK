## 什么是性能？

性能定位为完成某件任务所需要的的时间度量，换句话说，性能即响应时间。

数据库服务器的性能用查询时间来度量。

吞吐量：单位时间内的查询数量，是我们之前对性能定义的倒数。

## 哪些查询值得优化？

1. 一些只占总响应时间比重很小的查询是不值得优化的
2. 优化成本大于收益也不值得优化
3. 有异常情况的查询，很影响用户体验的查询，即使时间占比不高也需要优化。



### 慢查询日志

在mysql 5.1 版本之后，可以通过设置long_query_time的值来捕获高于该值的响应时间的查询，该参数的单位已经可以做到微妙级别了。该功能开销几乎可忽略不计



这里有一个mysql管理工具叫做Percona ToolKit，该工具所提供的的慢查询日志相比于Mysql的官方版本，有更多细节和有价值的信息，如查询执行计划，锁，I/O活动等。

常用命令：

pt-query-digest -----慢查询Log的分析。



有时候会因为权限问题而无法在服务器上记录查询，这个时候可以采用两种技术代替，都集成于pt-query-digest中

1. 使用pt-query-digest的--processlist选项不断查看SHOW FULL PROCESSLIST的输出，记录查询第一次出现和消失的时间，但是这种办法无法捕获所有查询，一些较快的查询可能在两次执行间隙就完成了。
2. 使用TCP抓包，捕获MYSQL客户端与服务端通信网络包，使用tcpdump，然后使用pt-query-digest --type = tcpdump选项进行分析，生成报告，此方法精度比较高。