# 关于java基础

本篇收集记录java基础知识

# java逃逸分析

java逃逸分析是在jdk6之后引入的，即分析了对象只在当前函数范围内使用，因而改为在栈上申请空间。而栈是函数运行完，立即清理的，所以不需要等到GC，大大缓解了gc的压力。当然如果不是只在当前函数范围用到的对象不行。

![逃逸分析关](E:\NoteBooks\java\img\逃逸分析_关.png)

关掉逃逸分析后，疯狂GC

<img src="E:\NoteBooks\java\img\逃逸分析_开.png" alt="逃逸分析开"  />

# 计算JAVA对象的大小

对象大小分为两部分：

1. 头
   1. 地址：4字节
   2. 标记：8字节
   3. 数组长度：4字节（如果对象是个数组的话）
2. 内容
   1. 非静态属性
   2. 非基本类型的对象占4字节（即就是一个地址）

可以引入lucene-core依赖包，使用RamUsageEstimator.shallowSizeOf()方法来计算对象大小。注意java中是按照8字节对齐对象，所以所有的对象都应该是8的倍数，有继承的情况下，先看父对象字段，再看该对象。